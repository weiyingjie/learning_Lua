### 设置元表

```lua
setmetatable(tab1, tab2) -- 将tab2设置成tab1的元表
getmetatable(tab1)	-- 获取tab1的元表，没有则返回nil
```



### __index元方法

当通过键访问table时，如果这个键没有对应的值，则会访问这个table的元表的**__index**，**\_\_index**可以是一个**表**或一个**函数**，当**\_\_index**是一个表时，则查询对应表中相应的键，当是一个函数时，将调用这个函数，并返回这个函数的**第一个**返回值

#### 总结

Lua 查找一个表元素时的规则，其实就是如下 3 个步骤:

-   1.在表中查找，如果找到，返回该元素，找不到则继续
-   2.判断该表是否有元表，如果没有元表，返回 nil，有元表则继续。
-   3.判断元表有没有 __index 方法，如果 __index 方法为 nil，则返回 nil；如果 __index 方法是一个表，则重复 1、2、3；如果 __index 方法是一个函数，则返回该函数的返回值。

该部分内容来自作者寰子：https://blog.csdn.net/xocoder/article/details/9028347

### __newindex元方法

__newindex元方法用于对表进行更新，赋值操作时当该表有对应键则不调用\_\_newindex方法，直接赋值，当表中没有对应键，则调用元表的元方法\_\_newindex